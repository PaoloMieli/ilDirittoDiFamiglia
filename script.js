const translations = {
    it: {
        nav_about: "Chi Sono",
        nav_practice: "Aree di Pratica",
        nav_family: "Diritto di Famiglia",
        nav_online: "Consulenza Online",
        nav_contact: "Contatti",
        hero_title: "Consulenza OnLine ed in presenza per il Futuro della Tua Famiglia.",
        hero_subtitle: "Navigare nel diritto di famiglia con empatia, competenza e dedizione incrollabile.",
        modal_title: "Informativa sui Cookie e Privacy",
        modal_text: "Utilizziamo i cookie per migliorare la tua esperienza. Cliccando su 'Accetto', acconsenti al trattamento dei tuoi dati secondo la nostra Privacy e Cookie Policy.",
        modal_accept: "Ho letto e Accetto",
        cta_schedule: "Prenota una Consulenza",
        box_title: "Di cosa hai bisogno?",
        box_default: "Seleziona un Servizio...",
        service_debt: "Recupero Crediti",
        service_contract: "Contrattualistica",
        service_malpractice: "Responsabilità Medica",
        service_liablity: "Responsabilità Civile",
        service_inheritance: "Cause Successorie",
        service_leases: "Locazioni",
        service_divorce: "Divorzio & Separazione",
        service_custody: "Affidamento dei Figli",
        service_adoption: "Adozione",
        service_mediation: "Mediazione",
        desc_debt: "Strategie efficaci per il recupero dei tuoi crediti, insoluti commerciali e privati.",
        desc_contract: "Redazione e revisione contrattuale per garantire la massima tutela dei tuoi interessi.",
        desc_malpractice: "Assistenza legale per vittime di errori medici e malasanità, per ottenere il giusto risarcimento.",
        desc_liablity: "Tutela e richiesta danni per responsabilità civile, infortuni e sinistri.",
        desc_inheritance: "Gestione di questioni ereditarie, testamenti, legittime e divisioni patrimoniali.",
        desc_leases: "Assistenza completa per locazioni, sfratti e gestione immobiliare.",
        desc_divorce: "Guidarti attraverso il processo con dignità e proteggere i tuoi interessi.",
        desc_custody: "Sostenere il miglior risultato possibile per te e i tuoi figli.",
        desc_adoption: "Aiutarti a far crescere la tua famiglia attraverso il processo legale di adozione.",
        desc_mediation: "Facilitare il dialogo costruttivo per raggiungere soluzioni amichevoli.",
        go_btn: "Vai",
        about_title: "Chi Sono",
        about_p1: "Sono l’Avv. Noemi Agostini e svolgo la mia attività professionale prevalentemente nell’ambito del diritto di famiglia, offrendo assistenza legale in materia di separazioni e divorzi, affidamento e mantenimento dei figli, responsabilità genitoriale, regolamentazione dei rapporti familiari e tutela dei minori, sia in sede giudiziale che stragiudiziale.<br><br>Opero con rigore professionale e costante aggiornamento normativo e giurisprudenziale, al fine di fornire soluzioni giuridiche adeguate alle specifiche esigenze del cliente e alla tutela dei diritti della persona. <br><br>Presto consulenze legali in presenza a Roma e consulenze online in materia di diritto di famiglia, garantendo professionalità, riservatezza e continuità dell’assistenza sull’intero territorio nazionale.",
        contact_title: "Contattaci",
        contact_info_title: "Informazioni di Contatto",
        form_name: "Nome",
        form_phone: "Telefono",
        form_email: "Email",
        form_message: "Messaggio",
        form_privacy_consent: "Dichiaro di aver letto la privacy policy dello Studio Legale Agostini e di acconsentire, ai soli fini del servizio richiesto, al trattamento dei miei dati personali. Consulta la <a href='#' class='privacy-link' onclick=\"window.open('privacy.html', 'PrivacyPolicy', 'width=600,height=800'); return false;\">privacy policy</a>.",
        form_send: "Invia Messaggio",
        consultation_banner: "Nota: Il seguente meeting è una proposta di appuntamento, l'avvocato si riserva di modificare l'appuntamento o proporre altri orari.",
        consultation_privacy: "Dichiaro di aver letto la privacy policy dello Studio Legale Agostini e di acconsentire, ai soli fini del servizio richiesto, al trattamento dei miei dati personali. Consulta la <a href='#' class='privacy-link' onclick=\"window.open('privacy.html', 'PrivacyPolicy', 'width=600,height=800'); return false;\">privacy policy</a>.",
        consultation_title: "Consulenza Online",
        consultation_subtitle: "Prenota la tua videochiamata direttamente dal calendario.",
        consultation_btn: "Prenota su Google Calendar",
        consultation_calendar_disclaimer: "Cliccando verrai reindirizzato al tuo Google Calendar per confermare l'evento e invitare l'avvocato.",

        social_title: "Seguimi sui Social",
        lang_label: "Lingua",

        // Footer
        footer_privacy: "Privacy Policy",
        footer_cookie: "Cookie Policy",
        footer_rights: "Tutti i diritti riservati.",

        // Specific Page Content (Legacy/Generic)
        page_divorce_title: "Servizi di Divorzio e Separazione",
        page_divorce_body: "Offriamo una rappresentanza legale completa per tutte le fasi del divorzio e della separazione legale.",
        page_custody_title: "Servizi di Affidamento",
        page_custody_body: "Il benessere dei tuoi figli è la nostra massima priorità.",
        page_adoption_title: "Servizi di Adozione",
        page_adoption_body: "Far crescere la tua famiglia è un viaggio gioioso.",
        page_mediation_title: "Servizi di Mediazione",
        page_mediation_body: "La mediazione offre un'alternativa al contenzioso in tribunale."
    },
    en: {
        nav_about: "About",
        nav_practice: "Practice Areas",
        nav_family: "Family Law",
        nav_online: "Online Consultation",
        nav_contact: "Contact",
        hero_title: "Compassionate Counsel for Your Family's Future.",
        hero_subtitle: "Navigating family law with empathy, expertise, and unwavering dedication.",
        modal_title: "Cookie & Privacy Policy",
        modal_text: "We use cookies to improve your experience. By clicking 'Accept', you agree to our Privacy and Cookie Policy.",
        modal_accept: "I Read and Accept",
        cta_schedule: "Schedule a Consultation",
        box_title: "How can we help?",
        box_default: "Select a Service...",
        service_debt: "Debt Recovery",
        service_contract: "Contract Law",
        service_malpractice: "Medical Malpractice",
        service_liablity: "Civil Liability",
        service_inheritance: "Inheritance",
        service_leases: "Leases",
        service_divorce: "Divorce & Separation",
        service_custody: "Child Custody",
        service_adoption: "Adoption",
        service_mediation: "Mediation",
        desc_debt: "Effective strategies for recovering your debts, commercial and private arrears.",
        desc_contract: "Drafting and reviewing contracts to ensure maximum protection of your interests.",
        desc_malpractice: "Legal assistance for victims of medical errors and malpractice to obtain fair compensation.",
        desc_liablity: "Protection and damage claims for civil liability, injuries, and accidents.",
        desc_inheritance: "Management of inheritance matters, wills, legitimacy, and asset division.",
        desc_leases: "Complete assistance for leases, evictions, and real estate management.",
        desc_divorce: "Guiding you through the process with dignity and protecting your interests.",
        desc_custody: "Advocating for the best possible outcome for you and your children.",
        desc_adoption: "Helping you grow your family through the legal adoption process.",
        desc_mediation: "Facilitating constructive dialogue to reach amicable solutions.",
        go_btn: "Go",
        about_title: "About Me",
        about_p1: "I am Avv. Noemi Agostini and I carry out my professional activity mainly in the field of family law, offering legal assistance in matters of separation and divorce, child custody and maintenance, parental responsibility, regulation of family relationships and protection of minors, both in judicial and extrajudicial settings. <br><br>I work with professional rigor and constant regulatory and jurisprudential updating, in order to provide legal solutions suitable for the specific needs of the client and the protection of personal rights. <br><br>I provide in-person legal consultations in Rome and online consultations in family law matters, ensuring professionalism, confidentiality, and continuity of assistance throughout the national territory.",
        contact_title: "Get in Touch",
        contact_info_title: "Contact Information",
        form_name: "Name",
        form_phone: "Phone",
        form_email: "Email",
        form_message: "Message",
        form_privacy_consent: "I declare that I have read the privacy policy of Studio Legale Agostini and validly consent, for the sole purposes of the requested service, to the processing of my personal data. Consult the <a href='#' class='privacy-link' onclick=\"window.open('privacy.html', 'PrivacyPolicy', 'width=600,height=800'); return false;\">privacy policy</a>.",
        form_send: "Send Message",
        consultation_banner: "Note: The following meeting is an appointment proposal. The lawyer reserves the right to modify the appointment or propose other times.",
        consultation_privacy: "I declare that I have read the privacy policy of Studio Legale Agostini and validly consent, for the sole purposes of the requested service, to the processing of my personal data. Consult the <a href='#' class='privacy-link' onclick=\"window.open('privacy.html', 'PrivacyPolicy', 'width=600,height=800'); return false;\">privacy policy</a>.",
        consultation_title: "Online Consultation",
        consultation_subtitle: "Book your video call directly from the calendar.",
        consultation_btn: "Book on Google Calendar",
        consultation_calendar_disclaimer: "By clicking, you will be redirected to your Google Calendar to confirm the event and invite the lawyer.",

        social_title: "Follow Me",
        lang_label: "Language",

        // Footer
        footer_privacy: "Privacy Policy",
        footer_cookie: "Cookie Policy",
        footer_rights: "All rights reserved.",

        page_divorce_title: "Divorce & Separation Services",
        page_divorce_body: "We offer comprehensive legal representation for all phases of divorce.",
        page_custody_title: "Child Custody Services",
        page_custody_body: "Your children's well-being is our top priority.",
        page_adoption_title: "Adoption Services",
        page_adoption_body: "Growing your family is a joyous journey.",
        page_mediation_title: "Mediation Services",
        page_mediation_body: "Mediation offers an alternative to courtroom litigation."
    },
    es: {
        nav_about: "Sobre Mí",
        nav_practice: "Áreas de Práctica",
        nav_family: "Derecho de Familia",
        nav_online: "Consulta Online",
        nav_contact: "Contacto",
        hero_title: "Consejo Compasivo para el Futuro de su Familia.",
        hero_subtitle: "Navegando el derecho familiar con empatía, experiencia y dedicación inquebrantable.",
        modal_title: "Política de Cookies y Privacidad",
        modal_text: "Utilizamos cookies para mejorar su experiencia. Al hacer clic en 'Aceptar', acepta nuestra Política de Privacidad y Cookies.",
        modal_accept: "He leído y Acepto",
        cta_schedule: "Programar Consulta",
        box_title: "¿Cómo podemos ayudar?",
        box_default: "Seleccione un Servicio...",
        service_debt: "Recuperación de Deudas",
        service_contract: "Derecho Contractual",
        service_malpractice: "Negligencia Médica",
        service_liablity: "Responsabilidad Civil",
        service_inheritance: "Herencias",
        service_leases: "Arrendamientos",
        service_divorce: "Divorcio y Separación",
        service_custody: "Custodia de los Hijos",
        service_adoption: "Adopción",
        service_mediation: "Mediación",
        desc_debt: "Estrategias efectivas para la recuperación de sus deudas, impagos comerciales y privados.",
        desc_contract: "Redacción y revisión de contratos para garantizar la máxima protección de sus intereses.",
        desc_malpractice: "Asistencia legal para víctimas de errores médicos y negligencia para obtener una compensación justa.",
        desc_liablity: "Protección y reclamación de daños por responsabilidad civil, lesiones y accidentes.",
        desc_inheritance: "Gestión de asuntos hereditarios, testamentos, legítimas y división de patrimonio.",
        desc_leases: "Asistencia completa para arrendamientos, desalojos y gestión inmobiliaria.",
        desc_divorce: "Guiándolo a través del proceso con dignidad y protegiendo sus intereses.",
        desc_custody: "Abogando por el mejor resultado posible para usted y sus hijos.",
        desc_adoption: "Ayudándole a hacer crecer su familia a través del proceso legal de adopción.",
        desc_mediation: "Facilitando el diálogo constructivo para alcanzar soluciones amistosas.",
        go_btn: "Ir",
        about_title: "Sobre Mí",
        about_p1: "Soy la Abogada Noemi Agostini y desarrollo mi actividad profesional principalmente en el ámbito del derecho de familia, ofreciendo asistencia legal en materia de separaciones y divorcios, custodia y manutención de los hijos, responsabilidad parental, regulación de las relaciones familiares y protección de menores, tanto en sede judicial como extrajudicial. <br><br>Opero con rigor profesional y constante actualización normativa y jurisprudencial, con el fin de proporcionar soluciones jurídicas adecuadas a las necesidades específicas del cliente y a la protección de los derechos de la persona. <br><br>Brindo asesoramiento legal presencial en Roma y asesoramiento online en materia de derecho de familia, garantizando profesionalidad, confidencialidad y continuidad de la asistencia en todo el territorio nacional.",
        contact_title: "Ponerse en Contacto",
        contact_info_title: "Información de Contacto",
        form_name: "Nombre",
        form_phone: "Teléfono",
        form_email: "Correo",
        form_message: "Mensaje",
        form_privacy_consent: "Declaro haber leído la política de privacidad del Studio Legale Agostini y dar mi consentimiento, únicamente a los efectos del servicio solicitado, para el tratamiento de mis datos personales. Consulte la <a href='#' class='privacy-link' onclick=\"window.open('privacy.html', 'PrivacyPolicy', 'width=600,height=800'); return false;\">política de privacidad</a>.",
        form_send: "Enviar Mensaje",
        consultation_banner: "Nota: La siguiente reunión es una propuesta de cita. El abogado se reserva el derecho de modificar la cita o proponer otros horarios.",
        consultation_privacy: "Declaro haber leído la política de privacidad del Studio Legale Agostini y dar mi consentimiento, únicamente a los efectos del servicio solicitado, para el tratamiento de mis datos personales. Consulte la <a href='#' class='privacy-link' onclick=\"window.open('privacy.html', 'PrivacyPolicy', 'width=600,height=800'); return false;\">política de privacidad</a>.",
        consultation_title: "Consulta Online",
        consultation_subtitle: "Reserve su videollamada directamente desde el calendario.",
        consultation_btn: "Reservar en Google Calendar",
        consultation_calendar_disclaimer: "Al hacer clic, será redirigido a su Google Calendar para confirmar el evento e invitar al abogado.",

        social_title: "Sígueme",
        lang_label: "Idioma",

        // Footer
        footer_privacy: "Política de Privacidad",
        footer_cookie: "Política de Cookies",
        footer_rights: "Todos los derechos reservados.",

        page_divorce_title: "Servicios de Divorcio",
        page_divorce_body: "Ofrecemos representación legal integral para todas las fases del divorcio.",
        page_custody_title: "Servicios de Custodia",
        page_custody_body: "El bienestar de sus hijos es nuestra máxima prioridad.",
        page_adoption_title: "Servicios de Adopción",
        page_adoption_body: "Hacer crecer su familia es un viaje alegre.",
        page_mediation_title: "Servicios de Mediación",
        page_mediation_body: "La mediación ofrece una alternativa al litigio judicial."
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Determine Language
    const savedLang = localStorage.getItem('sj_law_lang') || 'it';
    setLanguage(savedLang);

    // Cookie Consent Logic
    const consent = localStorage.getItem('cookie_consent');
    if (!consent) {
        // Inject Modal HTML
        const modalHTML = `
            <div id="consent-modal" class="modal-overlay">
                <div class="modal-content">
                    <h2 data-i18n="modal_title">Informativa sui Cookie e Privacy</h2>
                    <p data-i18n="modal_text">Utilizziamo i cookie per migliorare la tua esperienza. Cliccando su 'Accetto', acconsenti al trattamento dei tuoi dati secondo la nostra Privacy e Cookie Policy.</p>
                    <div class="modal-links">
                        <a href="privacy.html" target="_blank">Privacy Policy</a> | 
                        <a href="cookie.html" target="_blank">Cookie Policy</a>
                    </div>
                    <button id="accept-btn" class="btn-accept" data-i18n="modal_accept">Ho letto e Accetto</button>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);

        const modal = document.getElementById('consent-modal');
        // Small delay to allow CSS transition
        setTimeout(() => modal.classList.add('active'), 100);

        // Handle Accept
        document.getElementById('accept-btn').addEventListener('click', () => {
            localStorage.setItem('cookie_consent', 'true');
            modal.classList.remove('active');
            setTimeout(() => modal.remove(), 300);
        });

        // Re-apply translation to new modal
        setLanguage(savedLang);
    }

    // Smooth scrolling for anchors
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });

    // Intersection Observer
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
    };
    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

    // Language Dropdown Logic
    const langSelect = document.getElementById('language-select');

    if (langSelect) {
        langSelect.value = savedLang; // Set initial value
        langSelect.addEventListener('change', (e) => {
            const newLang = e.target.value;
            setLanguage(newLang);
            localStorage.setItem('sj_law_lang', newLang);
        });
    }

    // Mobile Menu Logic
    const mobileToggle = document.querySelector('.mobile-toggle');
    const navLinks = document.querySelector('.nav-links');

    if (mobileToggle && navLinks) {
        mobileToggle.addEventListener('click', () => {
            mobileToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
        });

        // Close menu when clicking a link
        navLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileToggle.classList.remove('active');
                navLinks.classList.remove('active');
            });
        });
    }

    // Service Selector Logic (Box)
    const serviceSelect = document.getElementById('service-select');
    const serviceGoBtn = document.getElementById('service-go-btn');

    if (serviceGoBtn && serviceSelect) {
        serviceGoBtn.addEventListener('click', () => {
            const page = serviceSelect.value;
            if (page) {
                window.location.href = page;
            }
        });
    }

    // Contact Form Logic (Mailto)
    const contactForm = document.querySelector('.contact-form');
    if (contactForm) {
        contactForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;

            const subject = encodeURIComponent(`Richiesta dal Sito Web: ${name}`);
            const body = encodeURIComponent(
                `Nome: ${name}\n` +
                `Telefono: ${phone}\n` +
                `Email: ${email}\n\n` +
                `Messaggio:\n${message}`
            );

            window.location.href = `mailto:avv.noemiagostini@gmail.com?subject=${subject}&body=${body}`;
        });
    }
});

function setLanguage(lang) {
    // Update text content
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.dataset.i18n;
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'OPTION') {
                element.textContent = translations[lang][key];
            } else {
                element.innerHTML = translations[lang][key];
            }
        }
    });

    // Update html lang attribute
    document.documentElement.lang = lang;
}
